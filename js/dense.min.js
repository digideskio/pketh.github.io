(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{e(window.jQuery||window.Zepto)}})(function(e){"use strict";var t=[],n={},r=/^([a-z]:)?\/\//i,i=/\.\w+$/,s;n.init=function(o){o=e.extend({ping:null,dimensions:"preserve",glue:"_",skipExtensions:["svg"]},o);this.each(function(){var u=e(this);if(!u.is("img")||u.hasClass("dense-image")){return}u.addClass("dense-image dense-loading");var a=n.getImageAttribute.call(this),f=u.attr("src"),l=false,c;if(!a){if(!f||s===1||e.inArray(f.split(".").pop().split(/[\?\#]/).shift(),o.skipExtensions)){u.removeClass("dense-image dense-loading");return}a=f.replace(i,function(e){return o.glue+s+"x"+e});l=o.ping!==false&&e.inArray(a,t)===-1&&(o.ping===true||!r.test(a)||a.indexOf("//"+document.domain)===0||a.indexOf(document.location.protocol+"//"+document.domain)===0)}c=function(){var e=function(){u.removeClass("dense-loading").addClass("dense-ready").trigger("denseRetinaReady.dense")};u.attr("src",a);if(o.dimensions==="update"){u.dense("updateDimensions").one("denseDimensionChanged",e)}else{if(o.dimensions==="remove"){u.removeAttr("width height")}e()}};if(l){e.ajax({url:a,type:"HEAD"}).done(function(e,n,r){var i=r.getResponseHeader("Content-type");if(!i||i.indexOf("image/")===0){t.push(a);c()}})}else{c()}});return this};n.updateDimensions=function(){return this.each(function(){var t,n=e(this),r=n.attr("src");if(r){t=new Image;t.src=r;e(t).on("load.dense",function(){n.attr({width:t.width,height:t.height}).trigger("denseDimensionChanged.dense")})}})};n.devicePixelRatio=function(){var t=1;if(e.type(window.devicePixelRatio)!=="undefined"){t=window.devicePixelRatio}else if(e.type(window.matchMedia)!=="undefined"){e.each([1.3,2,3,4,5,6],function(e,n){var r=["(-webkit-min-device-pixel-ratio: "+n+")","(min-resolution: "+Math.floor(n*96)+"dpi)","(min-resolution: "+n+"dppx)"].join(",");if(!window.matchMedia(r).matches){return false}t=n})}return Math.ceil(t)};n.getImageAttribute=function(){var t=e(this).eq(0),n=false,r;for(var i=1;i<=s;i++){r=t.attr("data-"+i+"x");if(r){n=r}}return n};s=n.devicePixelRatio();e.fn.dense=function(t,r){if(e.type(t)!=="string"||e.type(n[t])!=="function"){r=t;t="init"}return n[t].call(this,r)};e(function(){e("body.dense-retina img").dense()})})